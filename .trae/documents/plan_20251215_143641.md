# GitHub仓库与服务器部署准备指南

## 1. GitHub仓库准备（建议提前完成）

### 1.1 提前创建GitHub仓库的必要性
- **代码备份**：防止本地代码丢失
- **版本管理**：便于多人协作（未来可能）
- **CI/CD集成**：为自动化部署做准备
- **代码审查**：便于自我代码审查和改进

### 1.2 GitHub仓库创建步骤
- 登录GitHub，创建新仓库（建议与项目名一致）
- 选择公共或私有仓库（个人项目建议私有）
- 不勾选初始化选项（保留我们已有的.gitignore等配置）
- 复制仓库URL（HTTPS或SSH）

### 1.3 本地仓库与GitHub关联
- 在本地项目中添加远程仓库：`git remote add origin <仓库URL>`
- 验证关联：`git remote -v`
- 首次推送代码：`git push -u origin main`

## 2. 服务器部署准备

### 2.1 服务器环境准备
- 安装Node.js 18.x
- 安装pnpm
- 安装Nginx
- 安装PM2（用于管理Node.js进程）
- 安装Git（用于拉取代码）

### 2.2 从GitHub拉取代码到服务器
- 在服务器上创建部署目录：`mkdir -p /var/www/qmeta`
- 克隆GitHub仓库：`git clone <仓库URL> /var/www/qmeta`
- 切换到对应分支：`git checkout main`
- 拉取最新代码：`git pull origin main`

### 2.3 前端部署流程
- 安装依赖：`pnpm install`
- 构建项目：`pnpm build`
- 配置Nginx指向构建输出目录（通常是`dist/`）

### 2.4 后端部署流程
- 安装依赖：`pnpm install`
- 构建项目（如果需要）：`pnpm build`
- 使用PM2启动后端服务：`pm2 start <入口文件>`
- 配置Nginx反向代理到后端端口

## 3. 数据库部署与管理

### 3.1 数据库不直接存储在Git中的原因
- 数据库包含实际业务数据，体积大
- 数据频繁变化，不适合版本控制
- 包含敏感信息，存在安全风险

### 3.2 数据库部署方案
- **本地开发环境**：安装本地数据库或使用Docker容器
- **服务器环境**：
  - 直接安装数据库服务
  - 或使用Docker容器管理
  - 建议使用云数据库服务（如腾讯云数据库）

### 3.3 数据库初始化与迁移
- 创建数据库迁移脚本（推荐使用Prisma、TypeORM等工具）
- 服务器部署时执行迁移脚本：`pnpm migrate:deploy`
- 初始化必要的种子数据

## 4. 配置文件与环境变量管理

### 4.1 环境变量分离
- 开发环境：`.env.development`
- 生产环境：`.env.production`
- 服务器上创建`.env`文件，包含生产环境配置

### 4.2 敏感信息保护
- 不要将`.env`文件提交到Git
- 在GitHub仓库中使用Secrets存储敏感信息
- 服务器上通过安全方式管理环境变量

## 5. CI/CD自动化部署配置

### 5.1 GitHub Actions配置
- 创建构建工作流：监听main分支推送，自动构建项目
- 创建部署工作流：构建成功后，自动部署到服务器
- 配置服务器SSH密钥和环境变量

### 5.2 自动化部署流程
1. 本地提交代码到GitHub
2. GitHub Actions自动构建项目
3. 构建成功后，自动部署到服务器
4. 执行数据库迁移（如果有）
5. 重启相关服务

## 6. 监控与日志

### 6.1 服务器监控
- 配置基础监控：CPU、内存、磁盘使用率
- 设置简单的告警机制

### 6.2 应用日志
- 前端错误日志收集
- 后端日志使用PM2管理：`pm2 logs`
- 数据库查询日志配置

## 7. 安全配置

### 7.1 服务器安全
- 配置防火墙规则
- 禁用root远程登录
- 定期更新系统和依赖

### 7.2 HTTPS配置
- 申请SSL证书（推荐Let's Encrypt）
- 配置Nginx支持HTTPS

## 预期准备成果

通过以上准备工作，您将获得：
1. 完整的GitHub代码托管方案
2. 标准化的服务器部署流程
3. 安全可靠的数据库管理策略
4. 自动化的CI/CD部署流程
5. 基础的监控和日志系统
6. 安全的服务器配置

这些准备工作将确保您的项目能够顺利部署到服务器，并保持稳定运行，同时便于后续的维护和扩展。